function l(o){if(!o)return{};const e=getComputedStyle(o);return{class:o.className||"",inlineStyle:o.getAttribute("style")||"",computed:{display:e.display,width:o.style.width||e.width,height:o.style.height||e.height,backgroundColor:o.style.backgroundColor||e.backgroundColor,color:o.style.color||e.color,fontSize:o.style.fontSize||e.fontSize,padding:o.style.padding||e.padding,margin:o.style.margin||e.margin,borderRadius:o.style.borderRadius||e.borderRadius,textAlign:o.style.textAlign||e.textAlign}}}function g(o){const e={type:"unknown",props:{}};if(!o)return e;const t=o.querySelector(".Container-Text")||o.querySelector("img")||o.querySelector(".Separator")||o.querySelector("button")||o.firstElementChild.firstElementChild;if(e.wrapper=l(o),!t)return e.type="empty",e.props={html:o.innerHTML},e;if(t.classList[0]==="Container-Text"||t.tagName==="OL"||t.tagName==="UL")e.type="text",e.props={html:t.outerHTML.trim(),text:t.textContent.trim(),styleInline:t.getAttribute("style"),class:t.classList.toString()};else if(t.tagName==="IMG")e.type="image",e.props=Object.assign({src:t.getAttribute("src")||"",alt:t.getAttribute("alt")||"",id:t.dataset.id||null},l(t));else if(t.tagName==="BUTTON"||t.querySelector&&t.querySelector("button")){const s=t.tagName==="BUTTON"?t:t.querySelector("button");e.type="button",e.props={inlineStyle:s.getAttribute("style"),inlineClass:s.getAttribute("class"),dataId:t.getAttribute("data-id"),href:t.getAttribute("href"),DataSize:s.dataset.size,content:s.innerHTML.trim()}}else t.classList[0]==="Separator"?(e.type="Separator",e.props={html:t.outerHTML}):(e.type="html",e.props=Object.assign({html:t.outerHTML||t.innerHTML||t.textContent},l(t)));return e}function f(o,e={download:!1,post:!0}){try{o&&typeof o.preventDefault=="function"&&o.preventDefault();const t=document.getElementById("Container-pagina"),s=[];(t.querySelectorAll?t.querySelectorAll(".caja-proyecto"):[]).forEach(i=>{const n={type:"container",props:l(i),children:[]};Array.from(i.children).filter(a=>a.nodeType===1&&!a.classList.contains("box-toolbar")).forEach(a=>{const u={type:"container",props:Object.assign({id:a.id||null},l(a)),children:[]},d=a.querySelector(".Container_Data");d&&Array.from(d.children).forEach(y=>{const p=g(y);u.children.push(p)}),n.children.push(u)}),s.push(n)});const c=s;if(e.download){const i=new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),n=URL.createObjectURL(i),r=document.createElement("a");r.href=n,r.download="layout.json",document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(n)}if(e.post){const i=document.querySelector('meta[name="csrf-token"]'),n={"Content-Type":"application/json"};i&&(n["X-CSRF-TOKEN"]=i.getAttribute("content")),fetch(`/Proyectos/${window.pageId}/update`,{method:"PUT",headers:n,body:JSON.stringify({structure:c})}).then(r=>r.json()).then(r=>{console.log("Respuesta servidor:",r),window.dispatchEvent(new Event("clearTempFiles"))}).catch(r=>console.error("Error al enviar JSON al servidor:",r))}return c}catch(t){return console.error("Error generando JSON:",t),null}}export{f,g as s};
